(()=>{"use strict";class e{constructor(e,s,i){e&&(this._$=i,this._$el=i(e),this._params=s||{},this._initSelect2(),this._initEvents())}setValue(e){this._$el&&this._$el.val(e).trigger("change.select2")}getValue(){return this._$el.val()}setOptions(e){let s="";this._params.placeholder&&e.unshift({value:"",name:this._params.placeholder}),e.forEach((e=>{s+=`<option value="${e.value}">${e.name}</option>`})),this.setOptionsHtml(s),this._hasMirror()&&this._getMirror().setOptionsHtml(s),this._params.ajax&&this._params.ajax.target().setOptions([])}setOptionsHtml(e){this._$el&&this._$el.html(e)}_initSelect2(){let e=this;"function"==typeof this._$.fn.select2&&this._$el.select2({sorter:function(s){return s.sort((function(i,t){let n=e._$(".select2-search__field");if(0===n.length||""===n.val())return s;let a=i.text.toLowerCase(),l=t.text.toLowerCase(),c=n.val().toLowerCase();return a.indexOf(c)<l.indexOf(c)?-1:a.indexOf(c)>l.indexOf(c)?1:0})),s},language:{noResults:function(){return wc_ukr_shipping_globals.i10n.not_found}}})}_initEvents(){let e=this;e._$el.on("change",(function(){e._hasMirror()&&e._getMirror().setValue(e.getValue()),e._params.ajax&&e._getAjaxData()}))}_getAjaxData(){let e=this;e._trigger("beforeRequest");let s={action:e._params.ajax.action,_token:wc_ukr_shipping_globals.nonce,value:e.getValue()};"function"==typeof e._params.ajax.params&&(s=Object.assign(s,e._params.ajax.params())),e._$.ajax({method:"POST",url:wc_ukr_shipping_globals.ajaxUrl,data:s,dataType:"json",success:function(s){e._trigger("response",{data:s.data}),s.success&&e._params.ajax.target().setOptions(s.data.items)},error:function(s,i,t){e._trigger("response"),console.error(`WCUS Error: ${s.status} ${s.statusText}`)}})}_hasMirror(){return"function"==typeof this._params.mirror}_getMirror(){return this._params.mirror()}_trigger(e,s){this._params.events&&"function"==typeof this._params.events[e]&&this._params.events[e](this,s||{})}}const s={init:function(e){this._$=e,this.$differentShipping=this._$("#ship-to-different-address-checkbox")},setLoadingState:function(){this._$(".wc-ukr-shipping-np-fields").addClass("wcus-state-loading")},unsetLoadingState:function(){this._$(".wc-ukr-shipping-np-fields").removeClass("wcus-state-loading")},getFieldType:function(){return this.$differentShipping.length&&this.$differentShipping.prop("checked")?"shipping":"billing"},isCustomAddress:function(){let e=this.getFieldType();return this._$("#wcus_np_"+e+"_custom_address_active").prop("checked")?1:0},getAreaRef:function(){let e=this.getFieldType();return this._$("#wcus_np_"+e+"_area").val()},getCityRef:function(){let e=this.getFieldType();return this._$("#wcus_np_"+e+"_city").val()},mergeSelectParams:function(e){let s=this;return Object.assign({events:{beforeRequest:function(e){s.setLoadingState()},response:function(e){s.unsetLoadingState()}},i10n:{noResult:wc_ukr_shipping_globals.i10n.not_found}},e)}};!function(i){let t,n=document.getElementById("ship-to-different-address-checkbox");function a(){s.getCityRef()&&i(document.body).trigger("update_checkout")}s.init(i);let l=function(){let e=i(".shipping_method").length>1?i(".shipping_method:checked").val():i(".shipping_method").val();return e&&e.match(/^nova_poshta_shipping.+/i)};n&&n.addEventListener("click",(function(){l()&&(this.checked?(i("#wcus_np_shipping_fields").css("display","block"),i("#wcus_np_billing_fields").css("display","none")):(i("#wcus_np_shipping_fields").css("display","none"),i("#wcus_np_billing_fields").css("display","block")))}));i((function(){let c,o,r,_,p,d;i(".wc-ukr-shipping-np-fields").css("display","none"),i(document.body).bind("update_checkout",(function(e,i){s.setLoadingState()})),i(document.body).bind("updated_checkout",(function(e,a){t=i("#billing_country").length?i("#billing_country").val():"UA",l()?n&&n.checked?i("#wcus_np_shipping_fields").css("display","block"):i("#wcus_np_billing_fields").css("display","block"):i(".wc-ukr-shipping-np-fields").css("display","none"),l()&&1===parseInt(wc_ukr_shipping_globals.disableDefaultBillingFields)?(i("#billing_address_1_field").css("display","none"),i("#billing_address_2_field").css("display","none"),i("#billing_city_field").css("display","none"),i("#billing_state_field").css("display","none"),i("#billing_postcode_field").css("display","none"),i("#shipping_address_1_field").css("display","none"),i("#shipping_address_2_field").css("display","none"),i("#shipping_city_field").css("display","none"),i("#shipping_state_field").css("display","none"),i("#shipping_postcode_field").css("display","none")):(i("#billing_address_1_field").css("display","block"),i("#billing_address_2_field").css("display","block"),i("#billing_city_field").css("display","block"),i("#billing_state_field").css("display","block"),i("#billing_postcode_field").css("display","block"),i("#shipping_address_1_field").css("display","block"),i("#shipping_address_2_field").css("display","block"),i("#shipping_city_field").css("display","block"),i("#shipping_state_field").css("display","block"),i("#shipping_postcode_field").css("display","block")),s.unsetLoadingState()})),c=new e(document.getElementById("wcus_np_billing_area"),s.mergeSelectParams({mirror:()=>o,ajax:{action:"wcus_api_v2_get_cities",target:()=>r},placeholder:wc_ukr_shipping_globals.i10n.placeholder_area}),i),o=new e(document.getElementById("wcus_np_shipping_area"),s.mergeSelectParams({mirror:()=>c,ajax:{action:"wcus_api_v2_get_cities",target:()=>_},placeholder:wc_ukr_shipping_globals.i10n.placeholder_area}),i),r=new e(document.getElementById("wcus_np_billing_city"),s.mergeSelectParams({mirror:()=>_,ajax:{action:"wcus_api_v2_get_warehouses",target:()=>p},events:{beforeRequest:function(e){s.setLoadingState(),a()},response:function(e,i){s.unsetLoadingState()}},placeholder:wc_ukr_shipping_globals.i10n.placeholder_city}),i),_=new e(document.getElementById("wcus_np_shipping_city"),s.mergeSelectParams({mirror:()=>r,ajax:{action:"wcus_api_v2_get_warehouses",target:()=>d},events:{beforeRequest:function(e){s.setLoadingState(),a()},response:function(e,i){s.unsetLoadingState()}},placeholder:wc_ukr_shipping_globals.i10n.placeholder_city}),i),p=new e(document.getElementById("wcus_np_billing_warehouse"),s.mergeSelectParams({mirror:()=>d,placeholder:wc_ukr_shipping_globals.i10n.placeholder_warehouse}),i),d=new e(document.getElementById("wcus_np_shipping_warehouse"),s.mergeSelectParams({mirror:()=>p,placeholder:wc_ukr_shipping_globals.i10n.placeholder_warehouse}),i),i("body").on("change",'input[name="payment_method"]',(function(){a()})),function(){let e=i(".j-wcus-np-custom-address");e.length&&e.on("click",(function(){let e=document.getElementById(this.dataset.relationSelect);e&&(e.checked=this.checked),this.checked?(i(".j-wcus-warehouse-block").slideUp(400),i(".j-wcus-np-custom-address-block").slideDown(400)):(i(".j-wcus-warehouse-block").slideDown(400),i(".j-wcus-np-custom-address-block").slideUp(400)),a()}))}()}))}(jQuery)})();